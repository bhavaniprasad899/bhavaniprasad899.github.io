<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>CyberArena – Advanced Hacker Terminal</title>

<style>
  @import url('https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap');

  html, body {
    margin: 0; padding: 0;
    height: 100%;
    background: black;
    overflow: hidden;
    font-family: 'Share Tech Mono', monospace;
  }

  /* MATRIX CANVAS */
  #matrix {
    position: fixed;
    top: 0; left: 0;
    width: 100vw;
    height: 100vh;
    z-index: 0;
  }

  /* TERMINAL CONTAINER */
  .terminal {
    position: relative;
    z-index: 2;
    width: 90%;
    max-width: 900px;
    height: 85vh;
    margin: 40px auto 20px auto;
    background: rgba(0,0,0,0.9);
    border: 1px solid #00ff00;
    box-shadow: 0 0 30px #00ff00aa;
    padding: 20px;
    color: #00ff00;
    overflow-y: auto;
    user-select: none;
    display: flex;
    flex-direction: column;
  }

  .header {
    font-weight: bold;
    font-size: 1.2rem;
    text-align: center;
    margin-bottom: 15px;
    color: #00ff44;
    text-shadow: 0 0 8px #00ff44;
  }

  #output {
    flex-grow: 1;
    overflow-y: auto;
    font-size: 16px;
    line-height: 1.4;
    white-space: pre-wrap;
  }

  .line {
    margin: 6px 0;
  }

  .prompt {
    color: #00ff44;
  }

  #inputLine {
    display: flex;
    align-items: center;
    margin-top: 8px;
  }

  #inputPrompt {
    color: #00ff44;
    margin-right: 6px;
    user-select: none;
  }

  #cmd {
    background: transparent;
    border: none;
    outline: none;
    color: #00ffcc;
    font-family: 'Share Tech Mono', monospace;
    font-size: 16px;
    flex-grow: 1;
    caret-color: #00ff44;
  }

  /* Cursor blink */
  @keyframes blink {
    0%, 50% { border-color: #00ff44; }
    51%, 100% { border-color: transparent; }
  }

  #cmd {
    border-right: 2px solid #00ff44;
    animation: blink 1s step-start infinite;
  }

  /* Alternate terminal style */
  .terminal.red {
    border-color: #ff4444;
    box-shadow: 0 0 30px #ff4444aa;
    color: #ff4444;
  }

  .terminal.red .header {
    color: #ff4444;
    text-shadow: 0 0 8px #ff4444;
  }

  .terminal.red #inputPrompt {
    color: #ff4444;
  }

  .terminal.red #cmd {
    color: #ff6666;
    caret-color: #ff4444;
    border-right-color: #ff4444;
  }

  /* Scrollbar */
  ::-webkit-scrollbar {
    width: 8px;
  }
  ::-webkit-scrollbar-track {
    background: transparent;
  }
  ::-webkit-scrollbar-thumb {
    background: #00ff44;
    border-radius: 4px;
  }

  /* Button for toggle */
  #toggleTheme {
    position: fixed;
    top: 15px;
    right: 20px;
    background: transparent;
    border: 1px solid #00ff00;
    color: #00ff00;
    padding: 6px 10px;
    cursor: pointer;
    font-family: 'Share Tech Mono', monospace;
    font-weight: bold;
    border-radius: 4px;
    user-select: none;
    z-index: 5;
  }

  #toggleTheme.red {
    border-color: #ff4444;
    color: #ff4444;
  }

</style>

</head>
<body>

<canvas id="matrix"></canvas>

<button id="toggleTheme" title="Toggle Terminal Style">Toggle Style</button>

<div class="terminal" id="terminal">
  <div class="header">☠ CYBERARENA :: ADVANCED HACKER TERMINAL ☠</div>
  <div id="output" aria-live="polite" aria-atomic="false"></div>
  <div id="inputLine">
    <span id="inputPrompt" class="prompt">root@cyberarena:~$</span>
    <input type="text" id="cmd" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" autofocus />
  </div>
</div>

<script>
  /* ===== MATRIX RAIN ===== */
  const canvas = document.getElementById("matrix");
  const ctx = canvas.getContext("2d");
  let w, h;
  function resizeCanvas() {
    w = canvas.width = window.innerWidth;
    h = canvas.height = window.innerHeight;
  }
  window.addEventListener('resize', resizeCanvas);
  resizeCanvas();

  const letters = "アカサタナハマヤラワ0123456789";
  const fontSize = 16;
  const columns = Math.floor(w / fontSize);
  const drops = new Array(columns).fill(1);

  function drawMatrix() {
    ctx.fillStyle = "rgba(0,0,0,0.05)";
    ctx.fillRect(0, 0, w, h);
    ctx.fillStyle = "#00ff00";
    ctx.font = fontSize + "px monospace";

    for (let i = 0; i < drops.length; i++) {
      const text = letters[Math.floor(Math.random() * letters.length)];
      ctx.fillText(text, i * fontSize, drops[i] * fontSize);
      if (drops[i] * fontSize > h && Math.random() > 0.975) drops[i] = 0;
      drops[i]++;
    }
  }

  setInterval(drawMatrix, 35);

  /* ===== TERMINAL LOGIC ===== */
  const terminal = document.getElementById("terminal");
  const output = document.getElementById("output");
  const cmdInput = document.getElementById("cmd");
  const prompt = document.getElementById("inputPrompt");

  // Load saved session or defaults
  let sessionData = JSON.parse(localStorage.getItem("cyberarena_terminal_session")) || {
    cwd: "~",
    history: [],
    historyIndex: -1,
    outputLines: [
      "Booting Offensive Lab...",
      "Type 'help' to begin your mission.",
    ],
    theme: "green"
  };

  // Apply saved theme
  if (sessionData.theme === "red") {
    terminal.classList.add("red");
    toggleThemeBtn.classList.add("red");
  }

  // Render saved output
  function renderOutput() {
    output.innerHTML = "";
    sessionData.outputLines.forEach(line => {
      appendLine(line);
    });
    scrollToBottom();
  }

  // Append line to output with typing animation
  function appendLine(text, delay = 0) {
    return new Promise(resolve => {
      const line = document.createElement("div");
      line.className = "line";
      output.appendChild(line);

      if (delay === 0) {
        line.textContent = text;
        scrollToBottom();
        resolve();
      } else {
        let i = 0;
        function typeWriter() {
          if (i < text.length) {
            line.textContent += text.charAt(i);
            i++;
            scrollToBottom();
            setTimeout(typeWriter, delay);
          } else {
            resolve();
          }
        }
        typeWriter();
      }
    });
  }

  // Scroll output to bottom
  function scrollToBottom() {
    output.scrollTop = output.scrollHeight;
  }

  // Save session to localStorage
  function saveSession() {
    localStorage.setItem("cyberarena_terminal_session", JSON.stringify(sessionData));
  }

  // Command History Navigation
  cmdInput.addEventListener("keydown", e => {
    if (e.key === "ArrowUp") {
      e.preventDefault();
      if (sessionData.historyIndex < sessionData.history.length - 1) {
        sessionData.historyIndex++;
        cmdInput.value = sessionData.history[sessionData.history.length - 1 - sessionData.historyIndex];
      }
    } else if (e.key === "ArrowDown") {
      e.preventDefault();
      if (sessionData.historyIndex > 0) {
        sessionData.historyIndex--;
        cmdInput.value = sessionData.history[sessionData.history.length - 1 - sessionData.historyIndex];
      } else {
        sessionData.historyIndex = -1;
        cmdInput.value = "";
      }
    }
  });

  // Process command on Enter
  cmdInput.addEventListener("keydown", async e => {
    if (e.key === "Enter") {
      e.preventDefault();
      let cmd = cmdInput.value.trim();
      if (!cmd) return;

      // Add command to history
      sessionData.history.push(cmd);
      sessionData.historyIndex = -1;

      // Show prompt + command
      await appendLine(`root@cyberarena:${sessionData.cwd}$ ${cmd}`, 10);

      cmdInput.value = "";

      // Handle the command output
      await handleCommand(cmd.toLowerCase());

      // Save session after each command
      saveSession();
    }
  });

  // Terminal commands implementation
  async function handleCommand(cmd) {
    switch(true) {
      case cmd === "help":
        await appendLine(`Available Commands:
        
File System:
- ls
- cd [folder]
- pwd
- cat [file]

System:
- whoami
- clear
- reboot

Security Tools:
- nmap [target]
- msfconsole
- setoolkit
- sqlmap -u [url]
- nikto -h [target]
- hydra [user] [pass] [target]
- whois [domain]

Type 'clear' to clear the terminal.`);
        break;

      case cmd === "ls":
        await appendLine((fileSystem[sessionData.cwd] || []).join("  ") || "empty");
        break;

      case cmd.startsWith("cd "):
        {
          let dir = cmd.split(" ")[1];
          let newPath = sessionData.cwd === "~" ? "/home/root" : sessionData.cwd; // Fix root alias
          if (dir === "..") {
            if (newPath !== "/") {
              newPath = newPath.split('/').slice(0, -1).join('/') || "/";
            }
          } else {
            if (fileSystem[newPath + "/" + dir]) {
              newPath = newPath + "/" + dir;
            } else {
              await appendLine(`cd: no such file or directory: ${dir}`);
              return;
            }
          }
          sessionData.cwd = newPath;
          prompt.textContent = `root@cyberarena:${sessionData.cwd}$`;
        }
        break;

      case cmd === "pwd":
        await appendLine(sessionData.cwd);
        break;

      case cmd.startsWith("cat "):
        {
          let file = cmd.split(" ")[1];
          if (fileContents[file]) {
            await appendLine(fileContents[file]);
          } else {
            await appendLine(`cat: file not found: ${file}`);
          }
        }
        break;

      case cmd === "whoami":
        await appendLine("root");
        break;

      case cmd.startsWith("nmap "):
        {
          let target = cmd.split(" ")[1];
          await appendLine(`Starting Nmap scan on ${target}...`);
          await delay(1200);
          await appendLine(`
PORT     STATE SERVICE
21/tcp   open  ftp
22/tcp   open  ssh
80/tcp   open  http
443/tcp  open  https

Scan report for ${target}
Nmap done.`);
        }
        break;

      case cmd === "msfconsole":
        await appendLine("Launching Metasploit Framework...");
        await delay(1500);
        await appendLine(`
msf6 > use exploit/multi/handler
msf6 exploit(handler) > set PAYLOAD windows/meterpreter/reverse_tcp
msf6 exploit(handler) > set LHOST 127.0.0.1
msf6 exploit(handler) > exploit

[*] Meterpreter session opened
`);
        break;

      case cmd === "setoolkit":
        await appendLine(`
Social-Engineering Toolkit (SET)
--------------------------------
1) Social-Engineering Attacks
2) Website Attack Vectors
3) Credential Harvester
4) Payload Generator

[Educational Simulation Only]
`);
        break;

      case cmd.startsWith("sqlmap"):
        await appendLine("Testing SQL Injection...");
        await delay(1300);
        await appendLine(`
[INFO] testing connection to the target URL
[INFO] injectable parameter found
[CRITICAL] Database vulnerable to SQL Injection
`);
        break;

      case cmd.startsWith("nikto"):
        await appendLine(`
- Nikto v2.1.6
+ Server: Apache/2.4.41
+ X-Powered-By: PHP/7.4
+ /admin: Admin panel found
+ OSVDB-3233: Directory indexing enabled
`);
        break;

      case cmd.startsWith("hydra"):
        await appendLine(`
Hydra v9.5
[ATTEMPT] login: admin password: admin123
[SUCCESS] Credentials Found!
`);
        break;

      case cmd.startsWith("whois "):
        {
          let domain = cmd.split(" ")[1];
          await appendLine(`
Domain Name: ${domain}
Registrar: Example Registrar
Creation Date: 2015-06-10
Expiry Date: 2026-06-10
Name Server: ns1.example.com
`);
        }
        break;

      case cmd === "clear":
        clearTerminal();
        break;

      case cmd === "reboot":
        await appendLine("Rebooting terminal...");
        await delay(1500);
        clearTerminal();
        break;

      default:
        await appendLine("command not found");
        break;
    }
  }

  // Helper delay function
  function delay(ms) {
    return new Promise(resolve => setTimeout(resolve, ms));
  }

  // Clear terminal content and reset prompt
  function clearTerminal() {
    sessionData.outputLines = [];
    output.innerHTML = "";
    prompt.textContent = `root@cyberarena:${sessionData.cwd}$`;
  }

  // File system simulation
  const fileSystem = {
    "/": ["home", "etc", "var"],
    "/home": ["root"],
    "/home/root": ["notes.txt", "tools.txt", "projects"],
    "/home/root/projects": ["ctf.txt"],
    "/etc": ["passwd", "hosts"],
  };

  const fileContents = {
    "notes.txt": "XSS -> input validation\nSQLi -> prepared statements\n",
    "tools.txt": "nmap\nburp\nmetasploit\n",
    "ctf.txt": "FLAG{cyberarena_terminal_master}"
  };

  // Save output lines after each command
  function saveOutputLine(text) {
    sessionData.outputLines.push(text);
    saveSession();
  }

  // Append line with typing and save it
  async function appendLine(text, delayTime = 0) {
    return new Promise(resolve => {
      const line = document.createElement("div");
      line.className = "line";
      output.appendChild(line);
      if (delayTime === 0) {
        line.textContent = text;
        scrollToBottom();
        saveOutputLine(text);
        resolve();
      } else {
        let i = 0;
        function typeWriter() {
          if (i < text.length) {
            line.textContent += text.charAt(i);
            i++;
            scrollToBottom();
            setTimeout(typeWriter, delayTime);
          } else {
            saveOutputLine(text);
            resolve();
          }
        }
        typeWriter();
      }
    });
  }

  // Scroll output to bottom
  function scrollToBottom() {
    output.scrollTop = output.scrollHeight;
  }

  // Toggle between green/red terminal theme
  const toggleThemeBtn = document.getElementById("toggleTheme");
  toggleThemeBtn.addEventListener("click", () => {
    if (terminal.classList.contains("red")) {
      terminal.classList.remove("red");
      toggleThemeBtn.classList.remove("red");
      sessionData.theme = "green";
    } else {
      terminal.classList.add("red");
      toggleThemeBtn.classList.add("red");
      sessionData.theme = "red";
    }
    saveSession();
  });

  // Initial render of saved output
  renderOutput();

  // Focus input on click anywhere on terminal
  terminal.addEventListener("click", () => cmdInput.focus());

  // Focus input on load
  cmdInput.focus();

</script>

</body>
</html>

